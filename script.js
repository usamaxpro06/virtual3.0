// Translation data
const translations = {
    en: {
        nav: {
            home: "Home",
            services: "Services",
            about: "About",
            contact: "Contact",
            pricing: "Pricing"
        },
        hero: {
            title: "Elite Virtual Computer",
            subtitle: "Services & Solutions",
            description: "Transform your technology experience with our premium remote computer services. Expert technicians available 24/7 for seamless solutions.",
            searchPlaceholder: "What computer service do you need?",
            exploreServices: "Explore Our Services",
            premiumPackages: "Premium Packages",
            trustedBy: "🏆 Trusted by 10,000+ Businesses",
            enterpriseSecurity: "Enterprise Security",
            bankGradeEncryption: "Bank-grade encryption",
            support247: "24/7 Support",
            lightningFastResponse: "Lightning-fast response",
            clientsCount: "10,000+ Clients",
            trustedWorldwide: "Trusted worldwide",
            enterpriseGradeSolutions: "Enterprise-Grade Solutions",
            enterpriseGradeDescription: "Experience unparalleled expertise with our comprehensive suite of professional computer services, designed to elevate your digital infrastructure."
        },
        services: {
            windowsActivation: "Windows Activation",
            softwareInstallation: "Software Installation",
            dataEntry: "Data Entry Services",
            systemSetup: "System Setup & Optimization",
            contactUs: "Contact Us"
        },
        pricing: {
            title: "Simple, Transparent Pricing",
            description: "Choose the package that best fits your needs. No hidden fees, no surprises.",
            packages: {
                basic: {
                    name: "Basic Package",
                    description: "Perfect for simple Windows activation needs",
                    buttonText: "Choose Basic"
                },
                advanced: {
                    name: "Advanced Package",
                    description: "Comprehensive setup with multiple installations",
                    buttonText: "Choose Advanced"
                },
                premium: {
                    name: "Premium Package",
                    description: "Complete computer setup and ongoing support",
                    buttonText: "Choose Premium"
                }
            }
        },
        about: {
            title: "About VirtualTech Pro",
            description: "We're a team of dedicated professionals providing reliable, secure, and efficient virtual computer services to clients worldwide.",
            ourStory: "Our Story",
            storyParagraph1: "Founded in 2020, VirtualTech Pro started with a simple mission: to provide professional computer services remotely, making expert technical help accessible to everyone, regardless of location.",
            storyParagraph2: "What began as a small team of tech enthusiasts has grown into a trusted service provider, helping thousands of clients with their computer needs. We've handled everything from simple Windows activations to complex system setups.",
            statsLabels: {
                happyClients: "Happy Clients",
                hoursOfService: "Hours of Service",
                successRate: "Success Rate",
                secureConnections: "Secure Connections"
            }
        },
        contact: {
            title: "Get In Touch",
            description: "Ready to get your computer issues resolved? Contact us today for a free quote and fast, professional service.",
            emailUs: "Email Us",
            callUs: "Call Us",
            whatsapp: "WhatsApp",
            sendEmail: "Send Email",
            callNow: "Call Now",
            openWhatsApp: "Open WhatsApp",
            chatInstantly: "Chat with us instantly",
            sendMessage: "Send Us a Message",
            sendMessageDesc: "Fill out the form below and we'll get back to you within 2 hours during business hours."
        },
        common: {
            getStarted: "Get Started",
            mostPopular: "Most Popular"
        },
        footer: {
            brandDescription: "Professional virtual computer services for all your tech needs. Fast, reliable, and secure.",
            quickLinks: "Quick Links",
            ourServices: "Our Services",
            pricing: "Pricing",
            aboutUs: "About Us",
            contact: "Contact",
            services: "Services",
            windowsActivation: "Windows Activation",
            softwareInstallation: "Software Installation",
            dataEntry: "Data Entry",
            systemSetup: "System Setup",
            technicalSupport: "Technical Support",
            contactInfo: "Contact Info",
            availableWorldwide: "Available Worldwide",
            copyright: "© 2024 VirtualTech Pro. All rights reserved."
        },
        search: {
            button: "Search"
        }
    },
    ar: {
        nav: {
            home: "الرئيسية",
            services: "الخدمات",
            about: "حولنا",
            contact: "اتصل بنا",
            pricing: "الأسعار"
        },
        hero: {
            title: "خدمات الحاسوب الافتراضية",
            subtitle: "المتميزة والحلول",
            description: "حوّل تجربتك التقنية مع خدمات الحاسوب الافتراضية المتميزة. فنيون خبراء متاحون على مدار الساعة لحلول سلسة.",
            searchPlaceholder: "ما خدمة الحاسوب التي تحتاجها؟",
            exploreServices: "استكشف خدماتنا",
            premiumPackages: "الباقات المتميزة",
            trustedBy: "🏆 موثوق من قبل أكثر من 10,000 شركة",
            enterpriseSecurity: "أمان المؤسسات",
            bankGradeEncryption: "تشفير بمستوى البنوك",
            support247: "دعم 24/7",
            lightningFastResponse: "استجابة سريعة كالبرق",
            clientsCount: "10,000+ عميل",
            trustedWorldwide: "موثوق به عالميًا",
            enterpriseGradeSolutions: "حلول على مستوى المؤسسات",
            enterpriseGradeDescription: "اختبر خبرة لا مثيل لها مع مجموعتنا الشاملة من خدمات الحاسوب المهنية، المصممة لرفع مستوى البنية التحتية الرقمية لديك."
        },
        services: {
            windowsActivation: "تفعيل ويندوز",
            softwareInstallation: "تثبيت البرامج",
            dataEntry: "خدمات إدخال البيانات",
            systemSetup: "إعداد وتحسين النظام",
            contactUs: "اتصل بنا"
        },
        pricing: {
            title: "تسعير بسيط وشفاف",
            description: "اختر الباقة التي تناسب احتياجاتك. لا رسوم خفية، لا مفاجآت.",
            packages: {
                basic: {
                    name: "الباقة الأساسية",
                    description: "مثالية لاحتياجات تفعيل ويندوز البسيطة",
                    buttonText: "اختر الأساسية"
                },
                advanced: {
                    name: "الباقة المتقدمة",
                    description: "إعداد شامل مع عدة تثبيتات",
                    buttonText: "اختر المتقدمة"
                },
                premium: {
                    name: "الباقة المميزة",
                    description: "إعداد حاسوب كامل ودعم مستمر",
                    buttonText: "اختر المميزة"
                }
            }
        },
        about: {
            title: "حول VirtualTech Pro",
            description: "نحن فريق من المهنيين المتفانين الذين يقدمون خدمات حاسوب افتراضية موثوقة وآمنة وفعالة للعملاء في جميع أنحاء العالم.",
            ourStory: "قصتنا",
            storyParagraph1: "تأسست VirtualTech Pro في عام 2020، بدأت بمهمة بسيطة: تقديم خدمات حاسوب مهنية عن بُعد، مما يجعل المساعدة التقنية المتخصصة في متناول الجميع، بغض النظر عن الموقع.",
            storyParagraph2: "ما بدأ كفريق صغير من عشاق التكنولوجيا نما ليصبح مقدم خدمة موثوق، يساعد آلاف العملاء في احتياجات الحاسوب الخاصة بهم. لقد تعاملنا مع كل شيء من تفعيل Windows البسيط إلى إعداد الأنظمة المعقدة.",
            statsLabels: {
                happyClients: "عملاء سعداء",
                hoursOfService: "ساعات الخدمة",
                successRate: "معدل النجاح",
                secureConnections: "اتصالات آمنة"
            }
        },
        contact: {
            title: "ابقى على تواصل",
            description: "مستعد لحل مشاكل الحاسوب الخاص بك؟ اتصل بنا اليوم للحصول على عرض سعر مجاني وخدمة سريعة ومهنية.",
            emailUs: "راسلنا",
            callUs: "اتصل بنا",
            whatsapp: "واتس آب",
            sendEmail: "إرسال بريد إلكتروني",
            callNow: "اتصل الآن",
            openWhatsApp: "فتح واتس آب",
            chatInstantly: "تحدث معنا فوراً",
            sendMessage: "أرسل لنا رسالة",
            sendMessageDesc: "املأ النموذج أدناه وسنعاود الاتصال بك خلال ساعتين خلال ساعات العمل."
        },
        common: {
            getStarted: "ابدأ الآن",
            mostPopular: "الأكثر شعبية"
        },
        footer: {
            brandDescription: "خدمات حاسوب افتراضية احترافية لجميع احتياجاتك التقنية. سريع وموثوق وآمن.",
            quickLinks: "روابط سريعة",
            ourServices: "خدماتنا",
            pricing: "الأسعار",
            aboutUs: "حولنا",
            contact: "اتصل بنا",
            services: "الخدمات",
            windowsActivation: "تفعيل ويندوز",
            softwareInstallation: "تثبيت البرامج",
            dataEntry: "إدخال البيانات",
            systemSetup: "إعداد النظام",
            technicalSupport: "الدعم الفني",
            contactInfo: "معلومات الاتصال",
            availableWorldwide: "متاح عالمياً",
            copyright: "© 2024 VirtualTech Pro. جميع الحقوق محفوظة."
        },
        search: {
            button: "بحث"
        }
    }
};

// Current language
let currentLang = 'en';

// DOM Elements
const elements = {
    languageBtn: document.getElementById('languageBtn'),
    languageDropdown: document.getElementById('languageDropdown'),
    mobileMenuBtn: document.getElementById('mobileMenuBtn'),
    mobileNav: document.getElementById('mobileNav'),
    contactForm: document.getElementById('contactForm'),
    toast: document.getElementById('toast')
};

// Initialize the application
function init() {
    // Set up event listeners
    setupEventListeners();
    
    // Initialize language
    const savedLang = localStorage.getItem('language') || 'en';
    setLanguage(savedLang);
    
    // Initialize smooth scrolling
    setupSmoothScrolling();
    
    // Initialize animations
    setupScrollAnimations();
    
    // Handle hash navigation
    handleHashNavigation();
}

// Set up all event listeners
function setupEventListeners() {
    // Language switcher
    if (elements.languageBtn) {
        elements.languageBtn.addEventListener('click', toggleLanguageDropdown);
    }
    
    // Language options
    document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', (e) => {
            const lang = e.currentTarget.dataset.lang;
            if (lang) {
                setLanguage(lang);
                closeLanguageDropdown();
            }
        });
    });
    
    // Mobile menu
    if (elements.mobileMenuBtn) {
        elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    }
    
    // Close mobile menu when clicking on links
    document.querySelectorAll('.nav-link-mobile').forEach(link => {
        link.addEventListener('click', closeMobileMenu);
    });
    
    // Contact form
    if (elements.contactForm) {
        elements.contactForm.addEventListener('submit', handleFormSubmit);
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.language-switcher')) {
            closeLanguageDropdown();
        }
    });
    
    // Navigation links
    document.querySelectorAll('a[href^="#"]').forEach(link => {
        link.addEventListener('click', handleNavClick);
    });
    
    // Update active nav links on scroll
    window.addEventListener('scroll', updateActiveNavLink);
    
    // Handle browser back/forward
    window.addEventListener('hashchange', handleHashNavigation);
}

// Language functions
function toggleLanguageDropdown() {
    if (elements.languageDropdown) {
        elements.languageDropdown.classList.toggle('active');
        elements.languageBtn.classList.toggle('active');
    }
}

function closeLanguageDropdown() {
    if (elements.languageDropdown) {
        elements.languageDropdown.classList.remove('active');
        elements.languageBtn.classList.remove('active');
    }
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    
    // Update HTML attributes
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    
    // Update language button
    updateLanguageButton(lang);
    
    // Translate all elements
    translatePage();
    
    // Update prices based on language
    updatePrices();
}

function updateLanguageButton(lang) {
    const flag = lang === 'ar' ? '🇸🇦' : '🇺🇸';
    const text = lang === 'ar' ? 'العربية' : 'English';
    
    const flagElement = elements.languageBtn.querySelector('.flag');
    const textElement = elements.languageBtn.querySelector('.lang-text');
    
    if (flagElement) flagElement.textContent = flag;
    if (textElement) textElement.textContent = text;
}

function translatePage() {
    const t = translations[currentLang];
    
    // Translate elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.dataset.i18n;
        const translation = getNestedTranslation(t, key);
        if (translation) {
            element.textContent = translation;
        }
    });
    
    // Translate placeholder attributes
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.dataset.i18nPlaceholder;
        const translation = getNestedTranslation(t, key);
        if (translation) {
            element.placeholder = translation;
        }
    });
}

function getNestedTranslation(obj, key) {
    return key.split('.').reduce((o, k) => o && o[k], obj);
}

function updatePrices() {
    document.querySelectorAll('[data-price-en][data-price-ar]').forEach(element => {
        const priceKey = currentLang === 'ar' ? 'data-price-ar' : 'data-price-en';
        const price = element.getAttribute(priceKey);
        if (price) {
            element.textContent = price;
        }
    });
}

// Mobile menu functions
function toggleMobileMenu() {
    if (elements.mobileMenuBtn && elements.mobileNav) {
        elements.mobileMenuBtn.classList.toggle('active');
        elements.mobileNav.classList.toggle('active');
    }
}

function closeMobileMenu() {
    if (elements.mobileMenuBtn && elements.mobileNav) {
        elements.mobileMenuBtn.classList.remove('active');
        elements.mobileNav.classList.remove('active');
    }
}

// Navigation functions
function handleNavClick(e) {
    const href = e.currentTarget.getAttribute('href');
    if (href.startsWith('#')) {
        e.preventDefault();
        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            // Update URL without triggering scroll
            history.pushState(null, '', href);
            
            // Close mobile menu
            closeMobileMenu();
        }
    }
}

function updateActiveNavLink() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link, .nav-link-mobile');
    
    let currentSection = '';
    
    sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        if (rect.top <= 100 && rect.bottom >= 100) {
            currentSection = section.id;
        }
    });
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
        }
    });
}

function handleHashNavigation() {
    const hash = window.location.hash;
    if (hash) {
        const targetId = hash.substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            setTimeout(() => {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
        }
    }
}

// Smooth scrolling setup
function setupSmoothScrolling() {
    // Already handled in handleNavClick
}

// Scroll animations
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in');
            }
        });
    }, observerOptions);
    
    // Observe elements for animation
    document.querySelectorAll('.service-card, .pricing-card, .contact-method, .stat-item').forEach(el => {
        observer.observe(el);
    });
}

// Form handling
function handleFormSubmit(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    
    // Validate required fields
    if (!data.name || !data.email || !data.message) {
        showToast('Please fill in all required fields.', 'error');
        return;
    }
    
    // Validate email
    if (!isValidEmail(data.email)) {
        showToast('Please enter a valid email address.', 'error');
        return;
    }
    
    // Simulate form submission
    showToast('Message sent successfully! We\'ll get back to you within 2 hours during business hours.', 'success');
    
    // Reset form
    e.target.reset();
    
    // Here you would normally send the data to your backend
    console.log('Form data:', data);
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Toast notifications
function showToast(message, type = 'success') {
    if (!elements.toast) return;
    
    elements.toast.textContent = message;
    elements.toast.className = `toast ${type}`;
    elements.toast.classList.add('show');
    
    setTimeout(() => {
        elements.toast.classList.remove('show');
    }, 5000);
}

// Search functionality
function handleSearch() {
    const searchInput = document.querySelector('.search-input');
    if (!searchInput) return;
    
    const query = searchInput.value.trim().toLowerCase();
    if (!query) return;
    
    // Simple search - scroll to services section
    const servicesSection = document.getElementById('services');
    if (servicesSection) {
        servicesSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }
    
    // Highlight matching services (basic implementation)
    const serviceCards = document.querySelectorAll('.service-card');
    serviceCards.forEach(card => {
        const title = card.querySelector('.service-title');
        const description = card.querySelector('.service-description');
        
        if (title && description) {
            const titleText = title.textContent.toLowerCase();
            const descText = description.textContent.toLowerCase();
            
            if (titleText.includes(query) || descText.includes(query)) {
                card.style.border = '2px solid var(--primary)';
                setTimeout(() => {
                    card.style.border = '';
                }, 3000);
            }
        }
    });
    
    showToast(`Searching for: ${query}`, 'success');
}

// Set up search functionality
document.addEventListener('DOMContentLoaded', () => {
    const searchBtn = document.querySelector('.search-btn');
    const searchInput = document.querySelector('.search-input');
    
    if (searchBtn) {
        searchBtn.addEventListener('click', handleSearch);
    }
    
    if (searchInput) {
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });
    }
});

// Utility functions
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Performance optimizations
const debouncedUpdateActiveNavLink = debounce(updateActiveNavLink, 100);
window.addEventListener('scroll', debouncedUpdateActiveNavLink);

// Initialize when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}

// Service Worker for offline functionality (optional)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
                console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
                console.log('SW registration failed: ', registrationError);
            });
    });
}